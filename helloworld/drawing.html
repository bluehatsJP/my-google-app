<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Rino's Drawing</title>
	<script type="text/javascript">
	blush = false;
 	var myCanvas;
	var img = new Image();
	//var img;

	function onLoad() {
		var convasDiv = document.getElementById("main");
		myCanvas = document.createElement("canvas");
		myCanvas.width = 960;
		myCanvas.height = 576;
		convasDiv.appendChild(myCanvas);

		var ctx = myCanvas.getContext('2d');

		canvasRect = myCanvas.getBoundingClientRect();

		document.addEventListener("mousemove",function(event) {
			mouseX = event.pageX - canvasRect.left;
			mouseY = event.pageY - canvasRect.top;
			if(blush) {
				ctx.beginPath();
				ctx.moveTo(x,y);
				ctx.lineTo(mouseX,mouseY);
				ctx.stroke();
			}
			x = mouseX;
			y = mouseY;
		});
		document.addEventListener("mousedown",function() {
			blush = true;
		});
		document.addEventListener("mouseup",function() {
			blush = false;
		});

		document.addEventListener("touchmove",function(event) {
			mouseX = event.touches[0].pageX - canvasRect.left;
			mouseY = event.touches[0].pageY - canvasRect.top;
			if(blush) {
				ctx.beginPath();
				ctx.moveTo(x,y);
				ctx.lineTo(mouseX,mouseY);
				ctx.stroke();
			}
			x = mouseX;
			y = mouseY;
			event.preventDefault();
		},false);
		document.addEventListener("touchstart",function(event) {
			blush = true;
			x = event.touches[0].pageX - canvasRect.left;
			y = event.touches[0].pageY - canvasRect.top;
		},false);
		document.addEventListener("touchend",function() {
			blush = false;
		},false);
	}

	function saveCanvas() {
		img.src = myCanvas.toDataURL("image/jpeg");
		//var ctx = myCanvas.getContext('2d');
		//img = ctx.getImageData(0, 0, myCanvas.width, myCanvas.height);

		//var strDataURI = myCanvas.toDataURL("image/jpeg");
		//var temp = "<img src=\"" + strDataURI + "\" alt=\"\" width=\"310px\" />";
		//window.open("data:text/html;base64," + window.btoa(temp));
	}

	function mailCanvas() {
		var strDataURI = myCanvas.toDataURL("image/jpeg");
		var temp = "<img src=\"" + strDataURI + "\" alt=\"\" width=\"310px\" />";
		location.href = "mailto:?body=" + temp;
	}

	function redoCanvas() {
		var ctx = myCanvas.getContext('2d');
		ctx.drawImage(img, 0, 0);
		console.log(img.src)
		//ctx.putImageData(img, 0, 0);
	}
	</script>
</head>
<body onLoad = "onLoad();">
<div id="main">
	<input onclick="saveCanvas();" type="button" value="SAVE" />
	<input onclick="redoCanvas();" type="button" value="REDO" />
	<input onclick="mailCanvas();" type="button" value="MAIL" />
</div>
</body>
</html>